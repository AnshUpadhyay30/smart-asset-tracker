<!-- Polished, enterprise-grade maintenance page -->
<section class="mnt-shell">

  <!-- Header -->
  <header class="hdr">
    <div class="crumb">
      <span class="brand">SmartAsset</span>
      <span class="sep">‚Ä∫</span>
      <span class="page">Maintenance</span>
    </div>

    <div class="actions">
      <button mat-stroked-button class="btn-outline" (click)="loadLogs()" [disabled]="!selectedAssetId" type="button" matTooltip="Reload logs">
        <mat-icon>refresh</mat-icon><span>Refresh</span>
      </button>

      <button
        mat-flat-button
        color="primary"
        class="btn-primary"
        (click)="openAddLog()"
        [disabled]="!selectedAssetId || !canCreate()"
        type="button"
        matTooltip="Add maintenance log">
        <mat-icon>add</mat-icon><span>Add Log</span>
      </button>
    </div>
  </header>

  <!-- Title row -->
  <div class="title-row">
    <div class="title">
      <span class="glyph" aria-hidden="true"><mat-icon>build_circle</mat-icon></span>
      <div class="stack">
        <h2>Maintenance</h2>
        <p class="muted">Create and review maintenance history of your assets</p>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <section class="filters">
    <mat-form-field appearance="outline" class="f asset">
      <mat-label>Asset</mat-label>
      <mat-select [(value)]="selectedAssetId" (valueChange)="loadLogs()">
        <mat-option *ngFor="let a of assets" [value]="a.id">
          {{ a.name }} ‚Ä¢ {{ a.location }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="f search">
      <mat-label>Search logs</mat-label>
      <input
        id="log-search"
        matInput
        placeholder="Description, parts, date‚Ä¶"
        (input)="applySearch($any($event.target).value)"
      />
      <button mat-icon-button matSuffix *ngIf="searchText" (click)="clearSearch()" aria-label="Clear">
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>
  </section>

  <mat-divider class="divider"></mat-divider>

  <!-- Loading -->
  <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

  <!-- Table -->
  <section class="table-card" *ngIf="dataSource.data?.length; else noData">
    <div class="table-scroller">
      <table
        mat-table
        [dataSource]="dataSource"
        [trackBy]="trackById"
        matSort
        class="mat-elevation-z1 grid-table">

        <!-- Service Date -->
        <ng-container matColumnDef="service_date">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="sticky">Service Date</th>
          <td mat-cell *matCellDef="let r">{{ formatDate(r.service_date) }}</td>
        </ng-container>

        <!-- Description -->
        <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="sticky">Description</th>
          <td mat-cell *matCellDef="let r" class="wrap-text">{{ r.description || '‚Äî' }}</td>
        </ng-container>

        <!-- Parts Used -->
        <ng-container matColumnDef="parts_used">
          <th mat-header-cell *matHeaderCellDef class="sticky">Parts Used</th>
          <td mat-cell *matCellDef="let r" class="wrap-text">{{ r.parts_used || '‚Äî' }}</td>
        </ng-container>

        <!-- Cost -->
        <ng-container matColumnDef="cost">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="sticky">Cost</th>
          <td mat-cell *matCellDef="let r">{{ r.cost || 0 | currency:'INR':'symbol':'1.0-0' }}</td>
        </ng-container>

        <!-- Next Due -->
        <ng-container matColumnDef="next_service_due">
          <th mat-header-cell *matHeaderCellDef class="sticky">Next Due</th>
          <td mat-cell *matCellDef="let r">{{ formatDate(r.next_service_due) || '‚Äî' }}</td>
        </ng-container>

        <!-- Actions -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="sticky center col-actions">Actions</th>
          <td mat-cell *matCellDef="let r" class="actions col-actions">
            <!-- Edit (Manager/Admin) -->
            <button
              mat-icon-button
              color="primary"
              matTooltip="Edit"
              type="button"
              (click)="$event.stopPropagation(); editLog(r)"
              *ngIf="canEdit()">
              <mat-icon>edit</mat-icon>
            </button>

            <!-- Delete (Admin only) -->
            <button
              mat-icon-button
              color="warn"
              matTooltip="Delete"
              type="button"
              (click)="$event.stopPropagation(); deleteLog(r)"
              *ngIf="isAdmin()">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <!-- Rows -->
        <tr mat-header-row *matHeaderRowDef="displayed" class="thead"></tr>
        <tr mat-row *matRowDef="let row; columns: displayed" class="trow"></tr>
      </table>
    </div>

    <!-- Paginator -->
    <mat-paginator
      [pageSize]="10"
      [pageSizeOptions]="[10, 25, 50, 100]"
      showFirstLastButtons>
    </mat-paginator>
  </section>

  <!-- Empty -->
  <ng-template #noData>
    <div class="empty">
      <div class="emoji" aria-hidden="true">üõ†Ô∏è</div>
      <p>No logs yet.</p>
      <p *ngIf="selectedAssetId && canCreate()">Use <b>Add Log</b> to create the first entry.</p>
      <p *ngIf="!selectedAssetId">Select an asset to view its logs.</p>
    </div>
  </ng-template>
</section>